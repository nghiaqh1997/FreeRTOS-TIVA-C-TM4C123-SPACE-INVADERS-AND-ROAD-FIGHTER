/*
 * Task4.c
 *
 *  Created on: May 19, 2022
 *      Author: nghia
 */
#include "include.h"
#include "Images.h"
#include "Task_def.h"
#include "Nokia5110/SPI.h"
#include "sprite.h"
int a = 0;
void PortAIntHandler(){
    uint32_t status = 0;
    status = GPIOIntStatus(GPIO_PORTA_BASE, true);
    GPIOIntClear(GPIO_PORTA_BASE, status);
    portBASE_TYPE xHigherPriorityTaskWoken = pdFALSE;
    if((status&GPIO_INT_PIN_5)==GPIO_INT_PIN_5){
        if(GPIOPinRead(GPIO_PORTA_BASE, GPIO_PIN_5)){
            Missile[0].image = Missile0;
            xSemaphoreGiveFromISR(xSemaphore3,&xHigherPriorityTaskWoken);
            portYIELD_FROM_ISR(xHigherPriorityTaskWoken);        }
    }
    if((status&GPIO_INT_PIN_6)==GPIO_INT_PIN_6){
        if(GPIOPinRead(GPIO_PORTA_BASE, GPIO_PIN_6)){
            Missile[0].image = Laser0;
            xSemaphoreGiveFromISR(xSemaphore3,&xHigherPriorityTaskWoken);
            portYIELD_FROM_ISR(xHigherPriorityTaskWoken);
        }
    }
}

void vTask4(void *pvParameters){
    portTickType xLastTaskWakeTime = xTaskGetTickCount();
    xSemaphoreTake(xSemaphore3,0);
    while(1){
        if(xSemaphoreTake(xSemaphore3,portMAX_DELAY)){
            if(Missile[0].life == 0){
                Missile[0].x = Player.x + 8;
                Missile[0].y = Player.y - 7;
                Missile[0].life = 1;
            }
            vTaskDelay(pdMS_TO_TICKS(500));
        }else{
            taskYIELD();
        }
    }
}



