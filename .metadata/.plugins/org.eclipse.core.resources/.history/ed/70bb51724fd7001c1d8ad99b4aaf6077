/*
 * Task1.c
 *
 *  Created on: May 18, 2022
 *      Author: nghia
 */
#include "include.h"
#include "Images.h"
#include "Task_def.h"
#include "Nokia5110/SPI.h"
void PortFIntHandler(){
    uint32_t status = 0;
    portBASE_TYPE xHigherPriorityTaskWoken = pdFALSE;
    status = GPIOIntStatus(GPIO_PORTF_BASE, true);
    GPIOIntClear(GPIO_PORTF_BASE, status);
    if((status&GPIO_INT_PIN_4)==GPIO_INT_PIN_4){
        if(~GPIOPinRead(GPIO_PORTF_BASE, GPIO_PIN_4)){
            UARTprintf("1\n");
            xSemaphoreGiveFromISR(xSemaphore1,&xHigherPriorityTaskWoken);
            portYIELD_FROM_ISR(xHigherPriorityTaskWoken);
        }
    }
    if((status&GPIO_INT_PIN_0)==GPIO_INT_PIN_0){
        if(~GPIOPinRead(GPIO_PORTF_BASE, GPIO_PIN_0)){

        }
    }
}
void Level1(){
    xSemaphoreTake(xMutex1,portMAX_DELAY);
    Nokia5110_ClearBuffer();
    Nokia5110_DisplayBuffer();
    Nokia5110_PrintBMP(32, 47, PlayerShip0, 0); // player ship middle bottom
    Nokia5110_PrintBMP(33, 47 - PLAYERH, Bunker0, 0);
    Nokia5110_PrintBMP(0, 47 - PLAYERH, Bunker1, 0);
    Nokia5110_PrintBMP(67, 47 - PLAYERH, Bunker2, 0);
    Nokia5110_PrintBMP(0, ENEMY10H - 1, SmallEnemy10PointA, 0);
    Nokia5110_PrintBMP(16, ENEMY10H - 1, SmallEnemy20PointA, 0);
    Nokia5110_PrintBMP(32, ENEMY10H - 1, SmallEnemy20PointA, 0);
    Nokia5110_PrintBMP(48, ENEMY10H - 1, SmallEnemy30PointA, 0);
    Nokia5110_PrintBMP(64, ENEMY10H - 1, SmallEnemy30PointA, 0);
    Nokia5110_PrintBMP(0, ENEMY10H - 1, SmallEnemy10PointA, 0);
    Nokia5110_PrintBMP(16, ENEMY10H - 1 + 9, SmallEnemy20PointA, 0);
    Nokia5110_PrintBMP(32, ENEMY10H - 1 + 9, SmallEnemy20PointA, 0);
    Nokia5110_PrintBMP(48, ENEMY10H - 1 + 9, SmallEnemy30PointA, 0);
    Nokia5110_PrintBMP(64, ENEMY10H - 1 + 9, SmallEnemy30PointA, 0);
    Nokia5110_PrintBMP(0, ENEMY10H - 1 + 18, SmallEnemy10PointA, 0);
    Nokia5110_PrintBMP(16, ENEMY10H - 1 + 18, SmallEnemy20PointA, 0);
    Nokia5110_PrintBMP(32, ENEMY10H - 1 + 18, SmallEnemy20PointA, 0);
    Nokia5110_PrintBMP(48, ENEMY10H - 1 + 18, SmallEnemy30PointA, 0);
    Nokia5110_PrintBMP(64, ENEMY10H - 1 + 18, SmallEnemy30PointA, 0);
    xSemaphoreGive(xMutex1);
}
void vTask1(void *pvParameters){
    portTickType xLastTaskWakeTime = xTaskGetTickCount();

    while(1){
        if(xSemaphoreTake(xSemaphore1,portMAX_DELAY)==pdTRUE){
            Level1();
            taskYIELD();
        }
    }
}


